 
# Triggers the workflow on push or pull request events but only for the master branch
on:
  push:
    branches: [ dev ]
  pull_request:
    branches: [ dev ]
 
jobs:
  deploy:
    runs-on: ubuntu-latest
 
    steps:
    # Checkout the repository code
    - uses: actions/checkout@v2
 
    # Setup Node.js
    - name: Setup Node
      uses: actions/setup-node@v1
    
    # Install Salesforce DX CLI
    - name: Install SFDX CLI
      run: npm install sfdx-cli --global
 
    # Authorize Salesforce Org
    - name: Authorize SF Org
      env:
        CLIENT_ID: ${{ secrets.SALESFORCEPRODCLIENTID }}
        USERNAME: ${{ secrets.SALESFORCEPRODUSERNAME }}
        INSTANCE_URL: ${{ secrets.SALESFORCEPRODINSTANCEURL }}
      run: sfdx force:auth:jwt:grant --clientid $CLIENT_ID --jwtkeyfile ./buildfiles/server.key --username $USERNAME --instanceurl $INSTANCE_URL -a prod
 
    # Run Validation of Manifest Package
    - name: Run Validation on Manifest Package
      run: sfdx force:mdapi:deploy -l RunLocalTests -c -d ./manifestPackage -u prod -w 10
    
    # Deploy Manifest Package
    - name: Deploy Manifest Package to SF Org
      run: sfdx force:mdapi:deploy -l RunLocalTests -d ./manifestPackage -u prod -w 10
